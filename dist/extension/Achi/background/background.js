import{AchiCaptcha}from"../common/api.js";import{chrome}from"../browser_bg.js";import{Config}from"../common/config.js";let API;async function init(){var e;void 0===API&&(e=await Config.getAll()).clientKey&&initApiClient(e.clientKey)}function initApiClient(e){API=new AchiCaptcha({clientKey:e})}self.popup_getConfig=async function(){return Config.getAll()},self.popup_setConfig=async function(e){return Config.set(e.key,e.value)},self.popup_checkClientKey=async function(e){return initApiClient(e.clientKey),API.checkClientKey()},self.content_solve=async function(e){return API[e.captchaType](e.params)},chrome.runtime.onMessage.addListener((t,e,i)=>(init().then(()=>{var e,n;return"recaptcha_image"===t.task?.type?(n=(e=t.task).type,API[n](e).then(e=>{i({message:"success",result:e})}).catch(e=>{i({message:"error",result:e})})):(n=t.name+"_"+t.action,void 0!==self[n]&&self[n](t).then(e=>{i({action:t.action,request:t,response:e})}).catch(e=>{i({action:t.action,request:t,error:e.message})})),!0}),!0));
